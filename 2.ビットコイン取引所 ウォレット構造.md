# ビットコイン取引所 ウォレット構造 学習ノート

---

## 1. 核心原則

> **「Private Keyを持つ者だけがコインを動かせる。」**

---

## 2. Private Key = 絶対的な権限

- Private Keyは**256ビットのランダムな数値**に過ぎない
- この数値を知る者は該当アドレスのコインを**すべて移動**させることができる
- ブロックチェーン上でその行動は**正常として認められる**
- **取り消す方法がない**

| 銀行 | ビットコイン |
|------|--------------|
| キャンセル可能 | キャンセル不可 |
| 中央機関が管理 | 鍵の所有者だけが管理 |

---

## 3. 取引所 = 鍵の管理者

```
取引所が保有する1万BTC
        ↓
特定のPrivate Keyが管理しているもの
        ↓
取引所 = 鍵の保管会社（ブロックチェーン会社ではない）
```

---

## 4. 3つの構成要素

| 構成要素 | 役割 | 説明 |
|----------|------|------|
| **Private Key（秘密鍵）** | 署名の生成 | 出金時に必須。絶対に非公開 |
| **Public Key（公開鍵）** | 署名の検証 | 秘密鍵から生成される。公開しても安全 |
| **Address（アドレス）** | 口座番号 | 公開鍵をハッシュした値。アドレスだけでは出金不可 |

### ハンコの例えで理解する

```
秘密鍵  =  ハンコそのもの
公開鍵  =  ハンコの形のサンプル
署名    =  押されたハンコの跡

ネットワークの検証方法：
「このハンコの跡は、このハンコの形から押されたものか？」
→ ハンコ（秘密鍵）自体は絶対に見ない
```

---

## 5. トランザクションの流れ

```
① 「このコインをあのアドレスへ送る」というデータを生成
          ↓
② Private Keyで署名
          ↓
③ ネットワークがPublic Keyで検証
          ↓
④ 有効であればブロックに追加 → コインの移動が完了
```

> 署名が通過すればコインは移動する。  
> これを止められる中央機関は存在しない。

---

## 6. Hot Wallet vs Cold Wallet

秘密鍵が盗まれると即座に全額が移動できてしまうため、  
**「その鍵をどこに置くべきか？」** という問題が生まれる。

| 区分 | Hot Wallet | Cold Wallet |
|------|------------|-------------|
| 接続状態 | サーバーに接続（オンライン） | 完全オフライン |
| 出金処理 | 自動処理が可能 | 手動処理 |
| セキュリティ | ハッキングリスク高 | 安全 |
| 速度 | 速い | 遅い |

> **秘密鍵がそのまま資産だ。**  
> 全資産をHot Walletに置けば、一度のハッキングで全額が失われる。

---

## 7. Multi-Sig（マルチシグ）

秘密鍵が1つだけだと、その鍵を盗んだ者が取引所の全資産を支配できてしまう。

```
通常の構造：
秘密鍵 1個 → 1人が単独で出金可能 → 内部者攻撃のリスク

2-of-3 Multi-Sig構造：
3個の鍵のうち2個がなければ出金不可
→ 内部者1人が単独で資産を持ち出せない
→ 鍵が1つ流出しても資産は安全
```

---

## 8. HD Wallet（階層的決定性ウォレット）

取引所はユーザーごとに固有の入金アドレスを割り当てる必要がある。

```
ユーザー100万人 = アドレス100万個が必要

 秘密鍵100万個をそれぞれ管理 → 事実上の地獄
 マスターキー1個から無限にアドレスを派生 → HD Wallet
```

---

## 9. 全体まとめ

> ビットコインはPrivate Key所有者が資産のすべての権限を持つ。  
> 取引所はその鍵を代わりに保管する構造であるため、  
> **鍵管理の設計こそが取引所セキュリティのすべてだ。**