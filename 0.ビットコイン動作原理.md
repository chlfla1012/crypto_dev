# ビットコイン基礎学習ノート

---

## 1. ビットコインのトランザクション（取引）の3種類

### 1-1. 通常取引（単純送金）
- **入力（Input）**: 1つのウォレット（送信者）
- **出力（Output）**: 2つ
  - ① 受信者ウォレットへ送る金額
  - ② 自分（送信者）に戻る**おつり（Change）**

> ビットコインは正確な金額に分割できないため、余った金額は必ずおつりの出力値として自分に返ってくる。

---

### 1-2. 統合取引（Consolidation Transaction）
- **入力（Input）**: 複数の少額UTXO
- **出力（Output）**: 1つの大きなUTXO
- **例え**: 小銭を1枚の紙幣に両替する行為
- **実行主体**: ウォレットアプリが自動的に処理する

---

### 1-3. バッチ取引（Transaction Batching）
- **入力（Input）**: 1つの大きな金額
- **出力（Output）**: 複数の受信者へ分配
- **活用例**: 企業が多数の従業員へ給与を一括支払いする場合

---

## 2. UTXO（未使用トランザクション出力）

**UTXO = Unspent Transaction Outputs**

- ビットコインは残高を直接保存せず、**UTXOのリスト**として管理する。
- つまりビットコインの台帳は「誰がいくら持っているか」ではなく、「まだ使われていない出力値は何か」を記録している。
- ネットワーク全体のすべてのUTXOを保存するとデータ量が膨大になるため、**ライトウェイトクライアント（Lightweight Client / SPV）** は自分に関連するUTXOのみを追跡する。

---

## 3. トランザクションの伝播（Transaction Propagation）

1. **自己完結性**: 取引に必要なすべての情報はトランザクションデータの中に含まれている。
2. **P2Pネットワーク**: 中央サーバーなしに、ビットコイン参加者全員へ伝播される。
3. **接続方式を問わない**: 有線・Wi-Fi・モバイルなど、あらゆる接続方法でビットコインノードへ送信できる。

---

## 4. ブロック生成とマイニング（Mining）

### 全体の流れ

```
新しいトランザクションが発生
      ↓
マイナーが候補ブロック（Candidate Block）を作成
  - 新しいトランザクションを含む
  - 追加データフィールドを含む（タイムスタンプ、前ブロックのハッシュなど）
      ↓
ノンス（Nonce）の値を変えながらハッシュ関数を繰り返し実行
  - 同じ入力 → 常に同じ出力
  - 入力が少しでも違えば → まったく異なる出力
      ↓
ハッシュ出力値がターゲット値（Target）以下か？
      ↓
  YES → マイニング成功（宝くじ当選）
  NO  → ノンスを変えて再試行
      ↓
有効なブロックをネットワークへ伝播
      ↓
他のノードが検証後、ブロックチェーンへ追加
```

### 重要概念まとめ

| 概念 | 説明 |
|------|------|
| **候補ブロック** | マイナーが作る、検証待ち状態のブロック |
| **ハッシュ関数** | 任意の入力値を固定長の出力値に変換する関数。入力が少しでも変わると出力がまったく変わる |
| **ノンス（Nonce）** | マイナーが繰り返し変更する数値。有効なハッシュを見つけるための「宝くじ番号」 |
| **ターゲット値（Target）** | プロトコルが定めた難易度基準。ハッシュ値がこの値以下であれば有効 |
| **プルーフ・オブ・ワーク（PoW）** | 有効なハッシュを見つけるこのプロセス全体を指す |

---

## 5. 全体の流れまとめ

```
[取引生成] → [ネットワーク伝播（P2P）] → [ノード検証] → [候補ブロックへ追加]
      → [マイニング（ハッシュ繰り返し）] → [ブロック有効性確認] → [ブロックチェーンへ追加]
```

> トランザクションは伝播されるだけでは完結しない。  
> **マイニングされてブロックに含まれて**初めて、ブロックチェーンの一部となる。